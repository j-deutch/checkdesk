<?php
/**
 * @file
 * Main checkdesk_multitenancy file
 */

define('CHECKDESK_MULTITENANCY_GROUP_TYPE', 'newsroom');

function _checkdesk_multitenancy_roles() {
  return array('group journalist', 'group citizen journalist', 'group admin');
}

/**
 * Implements hook_node_info().
 */
function checkdesk_multitenancy_node_info() {
  return array(
    CHECKDESK_MULTITENANCY_GROUP_TYPE => array(
      'name' => t('Newsroom'),
      'base' => 'node_content',
      'has_title' => TRUE,
      'title_label' => t('Name'),
      'description' => t('A newsroom is a single Checkdesk instance (tenant) inside the whole Checkdesk environment.'),
      'comment' => array('status' => 2),
    )
  );
}

/**
 * Implements hook_form().
 */
function checkdesk_multitenancy_form($node, $form_state) {
  return node_content_form($node, $form_state);
}

/**
 * Implements hook_og_default_roles_alter().
 */
function checkdesk_multitenancy_og_default_roles_alter(&$roles) {
  $roles = _checkdesk_multitenancy_roles();
}

/**
 * Implements hook_node_insert()
 */
function checkdesk_multitenancy_node_insert($node){
  if (og_is_group_type('node', $node->type)) {
    $og_roles = og_roles('node', $node->type);
    $rid = array_search('group journalist', $og_roles);
    og_role_grant('node', $node->nid, $node->uid, $rid);
  }
}
