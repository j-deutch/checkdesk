--- file.inc
+++ file.inc
@@ -475,6 +475,23 @@ function file_ensure_htaccess() {
  *   already present. Defaults to FALSE.
  */
 function file_create_htaccess($directory, $private = TRUE, $force_overwrite = FALSE) {
+
+  // Test the web server identity.
+  if (isset($_SERVER['SERVER_SOFTWARE']) && preg_match("/Apache/i", $_SERVER['SERVER_SOFTWARE'])) {
+    $is_apache = TRUE;
+  }
+  elseif (!isset($_SERVER['SERVER_SOFTWARE'])) {
+    // Skip this in Drush where SERVER_SOFTWARE is not set and .htaccess never used anyway.
+    $is_apache = FALSE;
+  }
+  else {
+    $is_apache = FALSE;
+  }
+
+  if (!$is_apache) {
+    return;
+  }
+
   if (file_uri_scheme($directory)) {
     $directory = file_stream_wrapper_uri_normalize($directory);
   }
